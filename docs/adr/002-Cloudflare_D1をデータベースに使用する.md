# ADR-002: Cloudflare D1をデータベースに使用する

## ステータス

- [x] 承認
- [ ] 保留
- [ ] 却下

## 論点

ECサイトのデータ永続化にどのデータベースを使用するか。

## 決定事項

Cloudflare D1（SQLiteベースのエッジデータベース）を使用する。

## 決定理由

- **エッジ最適化**: Workersと同じエッジロケーションで実行され、データアクセスの遅延を最小化できる
- **SQLite互換**: 標準的なSQL構文が使用でき、学習コストが低い
- **Workers統合**: バインディング経由で自然にアクセスでき、認証情報の管理が不要
- **開発体験**: ローカル開発時にもwranglerを通じて簡単にテストできる
- **スケーラビリティ**: グローバルレプリケーションにより、世界中のユーザーに高速アクセスを提供
- **コスト**: 無料枠が大きく、小〜中規模のECサイトに最適

## 代替案

### PostgreSQL（Neon/Supabase）

- より機能豊富だが、エッジからのアクセスにレイテンシーが発生
- リージョナルデータベースのため、グローバル展開時のパフォーマンスが劣る

### MongoDB Atlas

- NoSQLの柔軟性があるが、本プロジェクトではリレーショナルモデルが適切
- Workers環境でのHTTP接続はコネクションプールの管理が複雑

### Cloudflare KV

- Key-Valueストアのため、複雑なクエリやトランザクションが困難
- 結果整合性モデルのため、ECサイトの注文処理には不適切
