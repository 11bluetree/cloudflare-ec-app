# ADR-011: Drizzle ORMをデータアクセスに使用する

## ステータス

- [x] 承認
- [ ] 保留
- [ ] 却下

## 論点

Cloudflare D1へのデータアクセスにどのORMを使用するか、またはORMを使用せずSQLを直接記述するか。

## 決定事項

Drizzle ORMを使用してCloudflare D1へのデータアクセスを実装する。スキーマ定義とマイグレーションもDrizzleで管理する。

## 決定理由

- **D1公式サポート**: Cloudflare D1との統合が公式にサポートされており、エッジ環境で安定動作する
- **型安全性**: TypeScriptファーストの設計で、スキーマから型が自動生成され、完全な型安全性を提供
- **軽量**: バンドルサイズが小さく、Cloudflare Workersの1MB制限に適している
- **SQLライク**: SQLに近い構文でクエリを記述でき、学習コストが低い
- **マイグレーション管理**: `drizzle-kit`によるマイグレーション自動生成とバージョン管理
- **パフォーマンス**: オーバーヘッドが少なく、生成されるSQLが最適化されている
- **プリペアドステートメント**: 内部でプリペアドステートメントを使用し、SQLインジェクションを防止

## 代替案

### Prisma

- 型安全なORM体験が優れているが、D1サポートが実験的段階
- エッジ環境でのクライアント生成が複雑
- バンドルサイズが大きく、Workersには不向き

### 生SQL（ORMなし）

- 完全な制御が可能だが、型安全性が失われる
- スキーマとTypeScript型の同期を手動で管理する必要がある
- ボイラープレートコードが増加する

### Kysely

- 型安全なクエリビルダーだが、D1サポートがコミュニティベース
- Drizzleと比較してマイグレーション管理機能が弱い
